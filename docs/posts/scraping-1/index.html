<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Scraping - Refreshing Frequency | Julien&#39;s blog</title>
<meta name="keywords" content="">
<meta name="description" content="Scraping is a topic I like. Gathering data and making sure they are fresh is an interesting problem.
Among the many things that you have to do when scraping, making sure your data is fresh is an important one. Let’s give a few tips to our fellow scraper.
Problem definition
We are building a intelligent (hopefully) system that optimizes when we should visit an URL. We don’t want to spend too much resource on refreshing too often, and we want our data to be as fresh as possible.">
<meta name="author" content="Julien Seveno">
<link rel="canonical" href="https://bornlex.github.io/posts/scraping-1/">
<meta name="google-site-verification" content="XYZabc">
<meta name="yandex-verification" content="XYZabc">
<meta name="msvalidate.01" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://bornlex.github.io/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="16x16" href="https://bornlex.github.io/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="32x32" href="https://bornlex.github.io/%3Clink%20/%20abs%20url%3E">
<link rel="apple-touch-icon" href="https://bornlex.github.io/%3Clink%20/%20abs%20url%3E">
<link rel="mask-icon" href="https://bornlex.github.io/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://bornlex.github.io/posts/scraping-1/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous" />

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js" integrity="sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY" crossorigin="anonymous"></script>

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>


<script>
document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "$", right: "$", display: false}
        ]
    });
});
</script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZBJC7YD3QZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ZBJC7YD3QZ');
</script>

<meta property="og:title" content="Scraping - Refreshing Frequency" />
<meta property="og:description" content="Scraping is a topic I like. Gathering data and making sure they are fresh is an interesting problem.
Among the many things that you have to do when scraping, making sure your data is fresh is an important one. Let’s give a few tips to our fellow scraper.
Problem definition
We are building a intelligent (hopefully) system that optimizes when we should visit an URL. We don’t want to spend too much resource on refreshing too often, and we want our data to be as fresh as possible." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bornlex.github.io/posts/scraping-1/" /><meta property="og:image" content="https://bornlex.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2025-10-23T23:41:36+02:00" />
<meta property="article:modified_time" content="2025-10-23T23:41:36+02:00" /><meta property="og:site_name" content="Julien&#39;s blog" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://bornlex.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"/>

<meta name="twitter:title" content="Scraping - Refreshing Frequency"/>
<meta name="twitter:description" content="Scraping is a topic I like. Gathering data and making sure they are fresh is an interesting problem.
Among the many things that you have to do when scraping, making sure your data is fresh is an important one. Let’s give a few tips to our fellow scraper.
Problem definition
We are building a intelligent (hopefully) system that optimizes when we should visit an URL. We don’t want to spend too much resource on refreshing too often, and we want our data to be as fresh as possible."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://bornlex.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Scraping - Refreshing Frequency",
      "item": "https://bornlex.github.io/posts/scraping-1/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Scraping - Refreshing Frequency",
  "name": "Scraping - Refreshing Frequency",
  "description": "Scraping is a topic I like. Gathering data and making sure they are fresh is an interesting problem.\nAmong the many things that you have to do when scraping, making sure your data is fresh is an important one. Let’s give a few tips to our fellow scraper.\nProblem definition We are building a intelligent (hopefully) system that optimizes when we should visit an URL. We don’t want to spend too much resource on refreshing too often, and we want our data to be as fresh as possible.\n",
  "keywords": [
    
  ],
  "articleBody": "Scraping is a topic I like. Gathering data and making sure they are fresh is an interesting problem.\nAmong the many things that you have to do when scraping, making sure your data is fresh is an important one. Let’s give a few tips to our fellow scraper.\nProblem definition We are building a intelligent (hopefully) system that optimizes when we should visit an URL. We don’t want to spend too much resource on refreshing too often, and we want our data to be as fresh as possible.\nIn its most basic form, we are looking for such a function :\n$$ f: (u, h) \\to d, (u, h, d) \\in (\\mathbb{U}, \\mathbb{H}, \\mathbb{N}) $$\nWith :\n$\\mathbb{U}$ : the space of all URLs $\\mathbb{H}$ : the space of all HTML pages $\\mathbb{N}$ : the space of natural integers, in our case it is the delay before next visit Those are the basic inputs and outputs of the function. Of course, nothing prevents us from adding more.\nLooking at only the URL and content of the page might not be enough. When making a request to a website, we receive more than the content of the page.\nHere are a few things that our system can leverage :\nHTTP headers Website sitemap RSS feed URL Page content (HTML) Head/Metadata Body Our system should work on both new URLs and known URLs (URLs that we already visited in the past).\nThroughout this report, we will take two domains and specific URLs inside those domains as example :\nhttps://parissecret.com/que-faire-a-paris-ce-week-end/ https://www.lebonbon.fr/paris/sorties/ Data available HTTP Headers Many headers might be interesting for our system :\nCache-Control, and especially the following directives : max-age → maximum number of seconds the content is considered fresh s-maxage → similar to max-age above no-cache → a good indicator that the content is dynamic no-store → content is highly dynamic, so the browser/user should not cache this page Expires Roughly the same as Cache-Control, but it gives an absolute timestamp Age The time the content has been in cache for This can be used along with Cache-Control (like Cache-Control is 1h and Age is 30min, then we can refresh in 1h - 30min = 30min) ETag Provides a hash of the content of the page, which makes it easy to check whether a page has changed since last time Last-Modified Date and time when the resource was last modified, can be used to check whether the resource is the same as last time we checked HTTP headers and their meanings can be found at the following URL : https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers\nSitemap Sitemaps are goldmines. They can be found either in the robots.txt file (best solution) or directly at the https://domain.com/sitemap.xml (but this can vary).\nConsidering the website we monitor, the following directives can be found at the very end of the robots.txt :\n#Sitemaps Sitemap: https://parissecret.com/sitemap_index.xml Then request this page, we can see different sitemaps :\nSitemap Last Modified https://parissecret.com/page-sitemap.xml 2024-11-14 12:16 +00:00 https://parissecret.com/category-sitemap.xml 2025-10-23 15:37 +00:00 https://parissecret.com/author-sitemap.xml 2025-09-01 11:46 +00:00 https://parissecret.com/posts_v2-sitemap.xml 2019-09-24 16:24 +00:00 https://parissecret.com/posts_v2-sitemap2.xml 2020-10-02 09:18 +00:00 https://parissecret.com/posts_v2-sitemap3.xml 2021-06-01 11:11 +00:00 https://parissecret.com/posts_v2-sitemap4.xml 2022-02-09 17:56 +00:00 https://parissecret.com/posts_v2-sitemap5.xml 2022-12-20 14:20 +00:00 https://parissecret.com/posts_v2-sitemap6.xml 2023-11-14 11:16 +00:00 https://parissecret.com/posts_v2-sitemap7.xml 2024-09-24 12:23 +00:00 https://parissecret.com/posts_v2-sitemap8.xml 2025-05-20 09:24 +00:00 https://parissecret.com/posts_v2-sitemap9.xml 2025-10-23 15:37 +00:00 https://parissecret.com/posts-en-sitemap.xml 2025-02-10 15:44 +00:00 https://parissecret.com/posts-en-sitemap2.xml 2025-10-08 15:50 +00:00 https://parissecret.com/posts-en-sitemap3.xml 2025-10-23 15:37 +00:00 https://parissecret.com/posts-it-sitemap.xml 2025-04-29 10:36 +00:00 https://parissecret.com/posts-it-sitemap2.xml 2025-10-23 15:37 +00:00 https://parissecret.com/posts-pt-sitemap.xml 2025-05-19 07:19 +00:00 https://parissecret.com/posts-pt-sitemap2.xml 2025-10-23 15:37 +00:00 https://parissecret.com/posts-nl-sitemap.xml 2025-05-19 09:44 +00:00 https://parissecret.com/posts-nl-sitemap2.xml 2025-10-23 15:37 +00:00 https://parissecret.com/posts-es-sitemap.xml 2025-02-27 15:57 +00:00 https://parissecret.com/posts-es-sitemap2.xml 2025-10-23 14:40 +00:00 https://parissecret.com/posts-es-sitemap3.xml 2025-10-23 15:37 +00:00 https://parissecret.com/posts-de-sitemap.xml 2025-05-05 15:59 +00:00 https://parissecret.com/posts-de-sitemap2.xml 2025-10-23 15:37 +00:00 One can notice that some sitemaps seem to have not been used for a long time, but requesting the sitemaps that we have been refreshed since last crawl, we can for example use this one : https://parissecret.com/posts_v2-sitemap9.xml and see the following content at the very end of the table :\nhttps://parissecret.com/que-faire-a-paris-ce-week-end/ 0 2025-10-23 15:37 +00:00 which is our page. This is particularly interesting because we can directly see the last time it has been modified, allowing us to know whether we need to refresh the page or not.\nSometimes, sitemaps directly give frequencies at which articles or sub content are refreshed. For example, the sitemap taken from https://www.lebonbon.fr domain :\n\u003curl\u003e \u003cloc\u003ehttps://www.lebonbon.fr/paris/actu/\u003c/loc\u003e \u003clastmod\u003e2025-10-23\u003c/lastmod\u003e \u003cchangefreq\u003edaily\u003c/changefreq\u003e \u003cpriority\u003e0.5\u003c/priority\u003e \u003c/url\u003e \u003curl\u003e \u003cloc\u003ehttps://www.lebonbon.fr/paris/sorties/\u003c/loc\u003e \u003clastmod\u003e2025-10-22\u003c/lastmod\u003e \u003cchangefreq\u003edaily\u003c/changefreq\u003e \u003cpriority\u003e0.5\u003c/priority\u003e \u003c/url\u003e Another good thing with sitemaps is that they offer an overview of the whole website. So instead of requesting each page we monitor and checking the headers, URL, content… we can parse the whole sitemap and have a list of pages that need to be refreshed.\nRSS Feed RSS feeds are interesting because they are well formatted, easily available information pushed by the websites themselves. Al websites do not provide RSS feeds though.\nThere are multiple ways of finding whether a website has a RSS feed :\nChecking routes /rss /feed /rss.xml Looking inside the HTML tag \u003crss xmlns:atom=\"http://www.w3.org/2005/Atom\" xmlns:dc=\"http://purl.org/dc/elements/1.1/\" version=\"2.0\"\u003e \u003cchannel\u003e \u003ctitle\u003eL'Équipe - L'actualité du sport en continu.\u003c/title\u003e \u003clink\u003ehttps://www.lequipe.fr/\u003c/link\u003e \u003cdescription\u003eLe sport en direct sur L'Équipe. Les informations, résultats et classements de tous les sports. Directs commentés, images et vidéos à regarder et à partager\u003c/description\u003e \u003clanguage\u003efr-fr\u003c/language\u003e \u003ccopyright\u003eCopyright L'Equipe.fr\u003c/copyright\u003e \u003cpubDate\u003eThu, 23 Oct 2025 13:23:25 +0200\u003c/pubDate\u003e \u003citem\u003e \u003ctitle\u003eLe débrief du premier match de la saison de Wembanyama en NBA : « Une façon d'annoncer qu'il va tout écraser »\u003c/title\u003e \u003clink\u003ehttps://www.lequipe.fr/Basket/Actualites/Le-debrief-du-premier-match-de-la-saison-de-wembanyama-en-nba-une-facon-d-annoncer-qu-il-va-tout-ecraser/1603995#at_medium=RSS_feeds\u003c/link\u003e \u003cdescription\u003e \u003c![CDATA[ Ultra-dominateur face aux Dallas Mavericks pour son retour en NBA après huit mois d'absence, Victor Wembanyama a affiché dès le premier match de la saison des San Antonio Spurs les progrès effectués dans l'intervalle, avec une palette offensive plus complète que jamais. ]]\u003e \u003c/description\u003e \u003cdc:creator\u003eAmaury Perdriau\u003c/dc:creator\u003e \u003ccategory\u003eBasket, NBA, Spurs\u003c/category\u003e \u003cenclosure url=\"https://medias.lequipe.fr/img-photo-png/-/1500000000833469/0-828-552-75/0cb67.png\" length=\"50000\" type=\"image/jpeg\"/\u003e \u003cguid\u003ehttps://www.lequipe.fr/Basket/Actualites/Le-debrief-du-premier-match-de-la-saison-de-wembanyama-en-nba-une-facon-d-annoncer-qu-il-va-tout-ecraser/1603995\u003c/guid\u003e \u003cpubDate\u003eThu, 23 Oct 2025 13:21:49 +0200\u003c/pubDate\u003e \u003c/item\u003e ... \u003c/rss\u003e It is sometimes also possible to transform a page that aggregates posts into a RSS feed using rss.app. For example, using the following page from Le Bonbon : https://www.lebonbon.fr/paris/sorties/ we get an URL pointing to a JSON generated page that looks like :\n{ \"version\": \"https://jsonfeed.org/version/1.1\", \"title\": \"Précurseur de tendances\", \"home_page_url\": \"https://www.lebonbon.fr/paris/sorties/\", \"feed_url\": \"https://rss.app/feeds/v1.1/cCA4EDJMK6KOk6pl.json\", \"favicon\": \"https://www.lebonbon.fr/favicon/lebonbon/apple-touch-icon.png\", \"language\": \"fr\", \"description\": \"Découvre les événements à ne pas manquer près de chez toi : concerts, expositions, festivals, spectacles, soirées\", \"items\": [ { \"id\": \"884aac3ebda0c73be65a0e8a778b870b\", \"url\": \"https://www.lebonbon.fr/paris/bons-plans/que-faire-paris-week-end-24-26-octobre-2025/\", \"title\": \"Que faire à Paris ce week-end ? (24-26 octobre)\", \"content_text\": \"De l’art, de la fête, des spectacles et de la food… Les Bonbons, ce week-end sera pluvieux mais généreux – d’autant plus qu’on aura une heure en plus !\", \"content_html\": \"\\u003Cdiv\\u003E\\u003Cimg src=\\\"https://uploads.lebonbon.fr/source/2025/october/2083397/jagodabartus-lebonbon_2_1200.jpg\\\" style=\\\"width: 100%;\\\" /\\u003E\\u003Cdiv\\u003EDe l’art, de la fête, des spectacles et de la food… Les Bonbons, ce week-end sera pluvieux mais généreux – d’autant plus qu’on aura une heure en plus !\\u003C/div\\u003E\\u003C/div\\u003E\", \"image\": \"https://uploads.lebonbon.fr/source/2025/october/2083397/jagodabartus-lebonbon_2_1200.jpg\", \"date_published\": \"2025-10-23T17:00:00.000Z\", \"authors\": [ { \"name\": \"Maria Sumalla\" } ], \"attachments\": [ { \"url\": \"https://uploads.lebonbon.fr/source/2025/october/2083397/jagodabartus-lebonbon_2_1200.jpg\" } ] }, { \"id\": \"f90e21f1db9a67f263db44ea390e28d3\", \"url\": \"https://www.lebonbon.fr/paris/loisirs/cette-experience-incroyable-fait-vivre-batailles-napoleon-visiter-france-1800-a-paris/\", \"title\": \"Cette expérience incroyable fait vivre les batailles de Napoléon et visiter le Paris de l'époque\", \"content_text\": \"L’empereur fait son grand retour à Paris ! L’expérience immersive Napoléon, l’Épopée Immersive s’installe dans le cadre monumental de la Poste du Louvre, au cœur du 1er arrondissement.\", \"content_html\": \"\\u003Cdiv\\u003E\\u003Cimg src=\\\"https://uploads.lebonbon.fr/source/2025/october/2083339/realite-virtuelle-napoleon_2_1200.jpg\\\" style=\\\"width: 100%;\\\" /\\u003E\\u003Cdiv\\u003EL’empereur fait son grand retour à Paris ! L’expérience immersive Napoléon, l’Épopée Immersive s’installe dans le cadre monumental de la Poste du Louvre, au cœur du 1er arrondissement.\\u003C/div\\u003E\\u003C/div\\u003E\", \"image\": \"https://uploads.lebonbon.fr/source/2025/october/2083339/realite-virtuelle-napoleon_2_1200.jpg\", \"date_published\": \"2025-10-23T16:00:00.000Z\", \"authors\": [ { \"name\": \"La Rédac'\" } ], \"attachments\": [ { \"url\": \"https://uploads.lebonbon.fr/source/2025/october/2083339/realite-virtuelle-napoleon_2_1200.jpg\" } ] }, which is very easy to read.\nPage Metadata In case previous methods did not work, game is not over yet. The page contains valuable information. Before digging into what we can do with the content itself, let’s have a look at the meta tags contained in the head section of the HTML :\n\u003cmeta property=\"article:publisher\" content=\"https://www.facebook.com/paris.secret.sn/\" /\u003e \u003cmeta property=\"article:published_time\" content=\"2022-10-13T09:24:19+00:00\" /\u003e \u003cmeta property=\"article:modified_time\" content=\"2025-10-20T08:02:28+00:00\" /\u003e All pages are not equal and some websites might not embed such information, but when they do, it allows us to check easily (before using any LLM) whether the page has been refreshed since last time.\nURL URLs might contain valuable information that will allow us to guess the nature of the content. For example, we are interested in knowing when to refresh the following page :\n\"https://parissecret.com/que-faire-a-paris-ce-week-end/\" The URL itself contains the word “week-end”. Of course, nothing prevents the authors from adding articles during the week-end, on Mondays… But knowing that the page is going to be talking about what to do during the week-end, we might infer that the content can be refreshed once a day. It is not a news website that required us to monitor it every hour.\nThis might require the help of an LLM, slowing a bit the process.\nPage Content Finally, the content of the page. Having to understand the page itself is kind of the worst case scenario. We will definitely have to use an LLM (which is relatively slow) and because LLMs struggle with reading raw HTML (for instance the Huggingface home page is 160k tokens once tokenized, which is more than most models context size), we will have to preprocess the HTML into something that is readable.\nBut before digging into HTML transformation, let’s look at what we can expect from the content of the page. The parissecret page contains the following meta information about the article :\n\u003ca href=\"/author/lauracoll/\" class=\"notranslate\"\u003e Laura Coll\u003c/a\u003e - Rédactrice en chef\u003cspan class=\"single__author__bull-divider\"\u003e\u0026bull;\u003c/span\u003e \u003ctime class=\"single__author__date\" datetime=\"2025-10-20T08:02:28+00:00\"\u003eoctobre 20, 2025\u003c/time\u003e The refresh date is indeed present in the page. This is something we can use.\nSystem Intermediary Representation To transform HTML into something LLMs can ingest, an easy choice is markdown. Markdown is concise and LLMs are trained to see it. The disadvantage is that it flattens the file. The rich structure of the HTML is lost, and in some cases this might create difficulties on its own.\nThere are several ways of getting Markdown from HTML. It is not too difficult to write our own serialization system, allowing us to remove parts of the HTML that encodes no information such as images, scripts…\nA custom override of the LXML parser might look like :\nfrom lxml import etree, html from lxml.html import HtmlElement import re from custom_tags import Transparent, ToRemove, tags_to_remove class ElementClassLookup(etree.CustomElementClassLookup): def __init__(self): super().__init__() self.tag_to_class_map = load_classes() def lookup(self, node_type, doc, namespace, tag_name): \"\"\" Either a tag is explicitly handled or it is marked for removal. \"\"\" if node_type != 'element': return None if tag_name in tags_to_remove: return ToRemove return self.tag_to_class_map.get(tag_name, Transparent) class Parser(html.HTMLParser): def __init__(self, *args, **kwargs): super().__init__(*args, **kwargs) self.set_element_class_lookup(ElementClassLookup()) And a tag might look like :\nfrom custom_tags import Abstract class A(Abstract): tag = \"a\" def custom_serialize(self, level: int = 0, filtered_tag: list[str] = None, *args, **kwargs): \"\"\" has the following attributes: - class - href \"\"\" if self.remove_tag(filtered_tag): return \"\" link = self.attrib.get(\"href\", \"\") inner_content = self.serialize_content(with_children=True) return f\"[{inner_content}]({link})\\n\" def serialize_content(self, with_children: bool = True, filtered_tag: str = None) -\u003e str: if self.remove_tag(filtered_tag): return \"\" content = '' if self.text: content = self.text.strip() for child in self: if with_children: content += child.serialize_content(filtered_tag=filtered_tag, with_children=True).strip() if child.tail: content += self.get_tail().strip() return content.strip() The methods serialize_content, get_tail define how we want to serialize the content of the nodes.\nLLM Tool Calling Once the HTML is transformed into Markdown, the data extraction problem can be reframed as a tool calling problem. We can give a concrete usage of a tool call for this specific case.\nConsidering the schema contained in the **kwargs is formatted as follows :\n{ 'annotations': None, 'description': 'Extract data from the current page based on the provided schema.', 'inputSchema': { 'additionalProperties': False, 'properties': { 'date': { 'type': 'string', 'description': 'The date at which the page has been last modified.' }, 'time': { 'type': 'string', 'description': 'The time at which the page has been last modified.', } }, 'type': 'object' }, 'name': \"extract_data\" } This code might be used as a first draft/pseudo logic :\nclass ExtractionProperty(BaseModel): type: str description: Optional[str] = None class ExtractionSchema(RootModel[Dict[str, ExtractionProperty]]): pass class ExtractionDataTool(): \"\"\" This tool is very specific. The schema of its arguments is dynamic and needs to be inferred before calling the to_dict() method. \"\"\" def __init__(self, *args, **kwargs): pass def execute(self, schema: dict, markdown_content: str) -\u003e ToolCallResult: schema_model = ExtractionSchema.model_validate(schema) response = self.extract( markdown_content, schema_model, kwargs['to_extract'], ) if response: return ToolCallResult( success=True, result=f\"The extracted data is: {response}.\" ) return ToolCallResult( success=False, result=\"No data extracted. Please check the schema and the content of the page.\" ) def extract( self, markdown_content: str, schema: ExtractionSchema, to_extract: str ) -\u003e str: formatted_tool_call = { messages=self.build_messages( markdown_content, to_extract ), tools=[{ name='extract_data', description='Extract data from the current page based on the provided schema.', input_schema=FunctionParameters( properties=schema.model_dump(), type='object', additionalProperties=False ) }], } messages = self.llm_provider.completion(formatted_tool_call) results = extract_results_from_messages(messages) return results Frequency Update Formula As a conceptual exercise, I propose the following formula to update the frequency of scraping. Considering that we have stored every timestamp at which we refreshed the URL and whether the URL changed or not at that timestamp :\n$$ x = \\left{ (t_i, x_i) \\right}_{i \\lt en}, t_i \\in \\mathbb{N}, x_i \\in \\left{ 0, 1 \\right} $$\nThe $x_i$ value is either 0 if the page did not change when we refreshed it, 1 otherwise. We are looking for a refresh interval $f_n$ .\nLet’s define the following additional variables :\n$f_n$ the current refresh interval $r_n$ the current change rate (the proportion of times we check the page and it changed, for example $r_n = 0.5$ means that 50% of the times we checked the page the content changed since previous time) $r_{t}$ the target change rate A target change rate that is too low means that we check the page too often A target change rate that is too high that maybe the page is refreshed with a frequency lower than our scraping frequency, and we save some resources by scraping this page less often We can set the initial target change rate at 0.5 $\\alpha$ the smoothing factor, weights how much the near history matters more than the old history $k$ defines how much we change the interval at every update, could start with 0.2 An algorithm might work as follows :\nWe first update the change rate using the smoothing factor :\n$r_n = (\\alpha x_n) + ((1 - \\alpha) r_{n-1})$\nThen we refresh the interval :\n$f_n = f_{n-1} (1 - k (r_n - r_t))$\nThe closer $r_n$ is to $r_t$, the lower the difference, and thus the lower is the ajustement we make to the frequency. It is obvious to see that :\n$$ \\lim_{r_n \\to r_t} \\Delta f_n = 0 $$\nWhich is the property we want.\n",
  "wordCount" : "2424",
  "inLanguage": "en",
  "datePublished": "2025-10-23T23:41:36+02:00",
  "dateModified": "2025-10-23T23:41:36+02:00",
  "author":{
    "@type": "Person",
    "name": "Julien Seveno"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://bornlex.github.io/posts/scraping-1/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Julien's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://bornlex.github.io/%3Clink%20/%20abs%20url%3E"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://bornlex.github.io/" accesskey="h" title="Home (Alt + H)">
                <img src="https://bornlex.github.io/apple-touch-icon.png" alt="" aria-label="logo"
                    height="35">Home</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://bornlex.github.io/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="https://bornlex.github.io/archives" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/Bornlex/GPT2" title="GPT-2">
                    <span>GPT-2</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
            <li>
                <a href="https://github.com/Bornlex/Whitespace-interpreter" title="Whitespace Interpreter">
                    <span>Whitespace Interpreter</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
            <li>
                <a href="https://bornlex.github.io/posts/me/" title="About me">
                    <span>About me</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://bornlex.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://bornlex.github.io/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Scraping - Refreshing Frequency
    </h1>
    <div class="post-meta"><span title='2025-10-23 23:41:36 +0200 CEST'>October 23, 2025</span>&nbsp;·&nbsp;12 min&nbsp;·&nbsp;2424 words&nbsp;·&nbsp;Julien Seveno&nbsp;|&nbsp;<a href="https://github.com/%3cpath_to_repo%3e/content/posts/scraping-1.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> 
  <div class="post-content"><p>Scraping is a topic I like. Gathering data and making sure they are fresh is an interesting problem.</p>
<p>Among the many things that you have to do when scraping, making sure your data is fresh is an important one. Let’s give a few tips to our fellow scraper.</p>
<h2 id="problem-definition">Problem definition<a hidden class="anchor" aria-hidden="true" href="#problem-definition">#</a></h2>
<p>We are building a intelligent (hopefully) system that optimizes when we should visit an URL. We don’t want to spend too much resource on refreshing too often, and we want our data to be as fresh as possible.</p>
<p>In its most basic form, we are looking for such a function :</p>
<p>$$
f: (u, h) \to d, (u, h, d) \in (\mathbb{U}, \mathbb{H}, \mathbb{N})
$$</p>
<p>With :</p>
<ul>
<li>$\mathbb{U}$ : the space of all URLs</li>
<li>$\mathbb{H}$ : the space of all HTML pages</li>
<li>$\mathbb{N}$ : the space of natural integers, in our case it is the delay before next visit</li>
</ul>
<p>Those are the basic inputs and outputs of the function. Of course, nothing prevents us from adding more.</p>
<hr>
<p>Looking at only the URL and content of the page might not be enough. When making a request to a website, we receive more than the content of the page.</p>
<p>Here are a few things that our system can leverage :</p>
<ul>
<li>HTTP headers</li>
<li>Website sitemap</li>
<li>RSS feed</li>
<li>URL</li>
<li>Page content (HTML)
<ul>
<li>Head/Metadata</li>
<li>Body</li>
</ul>
</li>
</ul>
<hr>
<p>Our system should work on both new URLs and known URLs (URLs that we already visited in the past).</p>
<p>Throughout this report, we will take two domains and specific URLs inside those domains as example :</p>
<ul>
<li><a href="https://parissecret.com/que-faire-a-paris-ce-week-end/">https://parissecret.com/que-faire-a-paris-ce-week-end/</a></li>
<li><a href="https://www.lebonbon.fr/paris/sorties/">https://www.lebonbon.fr/paris/sorties/</a></li>
</ul>
<h2 id="data-available">Data available<a hidden class="anchor" aria-hidden="true" href="#data-available">#</a></h2>
<h3 id="http-headers">HTTP Headers<a hidden class="anchor" aria-hidden="true" href="#http-headers">#</a></h3>
<p>Many headers might be interesting for our system :</p>
<ul>
<li>Cache-Control, and especially the following directives :
<ul>
<li>max-age → maximum number of seconds the content is considered fresh</li>
<li>s-maxage → similar to max-age above</li>
<li>no-cache → a good indicator that the content is dynamic</li>
<li>no-store → content is highly dynamic, so the browser/user should not cache this page</li>
</ul>
</li>
<li>Expires
<ul>
<li>Roughly the same as Cache-Control, but it gives an absolute timestamp</li>
</ul>
</li>
<li>Age
<ul>
<li>The time the content has been in cache for</li>
<li>This can be used along with Cache-Control (like Cache-Control is 1h and Age is 30min, then we can refresh in 1h - 30min = 30min)</li>
</ul>
</li>
<li>ETag
<ul>
<li>Provides a hash of the content of the page, which makes it easy to check whether a page has changed since last time</li>
</ul>
</li>
<li>Last-Modified
<ul>
<li>Date and time when the resource was last modified, can be used to check whether the resource is the same as last time we checked</li>
</ul>
</li>
</ul>
<p>HTTP headers and their meanings can be found at the following URL : <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers">https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers</a></p>
<h3 id="sitemap">Sitemap<a hidden class="anchor" aria-hidden="true" href="#sitemap">#</a></h3>
<p>Sitemaps are goldmines. They can be found either in the robots.txt file (best solution) or directly at the <a href="https://domain.com/sitemap.xml">https://domain.com/sitemap.xml</a> (but this can vary).</p>
<p>Considering the website we monitor, the following directives can be found at the very end of the robots.txt :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">#Sitemaps
</span></span><span class="line"><span class="cl">Sitemap: https://parissecret.com/sitemap_index.xml
</span></span></code></pre></div><p>Then request this page, we can see different sitemaps :</p>
<table>
  <thead>
      <tr>
          <th>Sitemap</th>
          <th>Last Modified</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><a href="https://parissecret.com/page-sitemap.xml">https://parissecret.com/page-sitemap.xml</a></td>
          <td>2024-11-14 12:16 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/category-sitemap.xml">https://parissecret.com/category-sitemap.xml</a></td>
          <td>2025-10-23 15:37 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/author-sitemap.xml">https://parissecret.com/author-sitemap.xml</a></td>
          <td>2025-09-01 11:46 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts_v2-sitemap.xml">https://parissecret.com/posts_v2-sitemap.xml</a></td>
          <td>2019-09-24 16:24 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts_v2-sitemap2.xml">https://parissecret.com/posts_v2-sitemap2.xml</a></td>
          <td>2020-10-02 09:18 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts_v2-sitemap3.xml">https://parissecret.com/posts_v2-sitemap3.xml</a></td>
          <td>2021-06-01 11:11 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts_v2-sitemap4.xml">https://parissecret.com/posts_v2-sitemap4.xml</a></td>
          <td>2022-02-09 17:56 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts_v2-sitemap5.xml">https://parissecret.com/posts_v2-sitemap5.xml</a></td>
          <td>2022-12-20 14:20 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts_v2-sitemap6.xml">https://parissecret.com/posts_v2-sitemap6.xml</a></td>
          <td>2023-11-14 11:16 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts_v2-sitemap7.xml">https://parissecret.com/posts_v2-sitemap7.xml</a></td>
          <td>2024-09-24 12:23 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts_v2-sitemap8.xml">https://parissecret.com/posts_v2-sitemap8.xml</a></td>
          <td>2025-05-20 09:24 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts_v2-sitemap9.xml">https://parissecret.com/posts_v2-sitemap9.xml</a></td>
          <td>2025-10-23 15:37 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts-en-sitemap.xml">https://parissecret.com/posts-en-sitemap.xml</a></td>
          <td>2025-02-10 15:44 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts-en-sitemap2.xml">https://parissecret.com/posts-en-sitemap2.xml</a></td>
          <td>2025-10-08 15:50 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts-en-sitemap3.xml">https://parissecret.com/posts-en-sitemap3.xml</a></td>
          <td>2025-10-23 15:37 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts-it-sitemap.xml">https://parissecret.com/posts-it-sitemap.xml</a></td>
          <td>2025-04-29 10:36 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts-it-sitemap2.xml">https://parissecret.com/posts-it-sitemap2.xml</a></td>
          <td>2025-10-23 15:37 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts-pt-sitemap.xml">https://parissecret.com/posts-pt-sitemap.xml</a></td>
          <td>2025-05-19 07:19 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts-pt-sitemap2.xml">https://parissecret.com/posts-pt-sitemap2.xml</a></td>
          <td>2025-10-23 15:37 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts-nl-sitemap.xml">https://parissecret.com/posts-nl-sitemap.xml</a></td>
          <td>2025-05-19 09:44 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts-nl-sitemap2.xml">https://parissecret.com/posts-nl-sitemap2.xml</a></td>
          <td>2025-10-23 15:37 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts-es-sitemap.xml">https://parissecret.com/posts-es-sitemap.xml</a></td>
          <td>2025-02-27 15:57 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts-es-sitemap2.xml">https://parissecret.com/posts-es-sitemap2.xml</a></td>
          <td>2025-10-23 14:40 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts-es-sitemap3.xml">https://parissecret.com/posts-es-sitemap3.xml</a></td>
          <td>2025-10-23 15:37 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts-de-sitemap.xml">https://parissecret.com/posts-de-sitemap.xml</a></td>
          <td>2025-05-05 15:59 +00:00</td>
      </tr>
      <tr>
          <td><a href="https://parissecret.com/posts-de-sitemap2.xml">https://parissecret.com/posts-de-sitemap2.xml</a></td>
          <td>2025-10-23 15:37 +00:00</td>
      </tr>
  </tbody>
</table>
<p>One can notice that some sitemaps seem to have not been used for a long time, but requesting the sitemaps that we have been refreshed since last crawl, we can for example use this one : <a href="https://parissecret.com/posts_v2-sitemap9.xml">https://parissecret.com/posts_v2-sitemap9.xml</a> and see the following content at the very end of the table :</p>
<table>
  <thead>
      <tr>
          <th><a href="https://parissecret.com/que-faire-a-paris-ce-week-end/">https://parissecret.com/que-faire-a-paris-ce-week-end/</a></th>
          <th>0</th>
          <th>2025-10-23 15:37 +00:00</th>
      </tr>
  </thead>
  <tbody>
  </tbody>
</table>
<p>which is our page. This is particularly interesting because we can directly see the last time it has been modified, allowing us to know whether we need to refresh the page or not.</p>
<hr>
<p>Sometimes, sitemaps directly give frequencies at which articles or sub content are refreshed. For example, the sitemap taken from <a href="https://www.lebonbon.fr/">https://www.lebonbon.fr</a> domain :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">url</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="p">&lt;</span><span class="nt">loc</span><span class="p">&gt;</span>https://www.lebonbon.fr/paris/actu/<span class="p">&lt;/</span><span class="nt">loc</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="p">&lt;</span><span class="nt">lastmod</span><span class="p">&gt;</span>2025-10-23<span class="p">&lt;/</span><span class="nt">lastmod</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="p">&lt;</span><span class="nt">changefreq</span><span class="p">&gt;</span>daily<span class="p">&lt;/</span><span class="nt">changefreq</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="p">&lt;</span><span class="nt">priority</span><span class="p">&gt;</span>0.5<span class="p">&lt;/</span><span class="nt">priority</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">url</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">url</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="p">&lt;</span><span class="nt">loc</span><span class="p">&gt;</span>https://www.lebonbon.fr/paris/sorties/<span class="p">&lt;/</span><span class="nt">loc</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="p">&lt;</span><span class="nt">lastmod</span><span class="p">&gt;</span>2025-10-22<span class="p">&lt;/</span><span class="nt">lastmod</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="p">&lt;</span><span class="nt">changefreq</span><span class="p">&gt;</span>daily<span class="p">&lt;/</span><span class="nt">changefreq</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="p">&lt;</span><span class="nt">priority</span><span class="p">&gt;</span>0.5<span class="p">&lt;/</span><span class="nt">priority</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">url</span><span class="p">&gt;</span>
</span></span></code></pre></div><!-- raw HTML omitted -->
<p>Another good thing with sitemaps is that they offer an overview of the whole website. So instead of requesting each page we monitor and checking the headers, URL, content… we can parse the whole sitemap and have a list of pages that need to be refreshed.</p>
<!-- raw HTML omitted -->
<h3 id="rss-feed">RSS Feed<a hidden class="anchor" aria-hidden="true" href="#rss-feed">#</a></h3>
<p>RSS feeds are interesting because they are well formatted, easily available information pushed by the websites themselves. Al websites do not provide RSS feeds though.</p>
<p>There are multiple ways of finding whether a website has a RSS feed :</p>
<ul>
<li>Checking routes
<ul>
<li>/rss</li>
<li>/feed</li>
<li>/rss.xml</li>
</ul>
</li>
<li>Looking inside the HTML <!-- raw HTML omitted --> tag</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">rss</span> <span class="na">xmlns:atom</span><span class="o">=</span><span class="s">&#34;http://www.w3.org/2005/Atom&#34;</span> <span class="na">xmlns:dc</span><span class="o">=</span><span class="s">&#34;http://purl.org/dc/elements/1.1/&#34;</span> <span class="na">version</span><span class="o">=</span><span class="s">&#34;2.0&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="p">&lt;</span><span class="nt">channel</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>L&#39;Équipe - L&#39;actualité du sport en continu.<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="p">&lt;</span><span class="nt">link</span><span class="p">&gt;</span>https://www.lequipe.fr/<span class="p">&lt;/</span><span class="nt">link</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="p">&lt;</span><span class="nt">description</span><span class="p">&gt;</span>Le sport en direct sur L&#39;Équipe. Les informations, résultats et classements de tous les sports. Directs commentés, images et vidéos à regarder et à partager<span class="p">&lt;/</span><span class="nt">description</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="p">&lt;</span><span class="nt">language</span><span class="p">&gt;</span>fr-fr<span class="p">&lt;/</span><span class="nt">language</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="p">&lt;</span><span class="nt">copyright</span><span class="p">&gt;</span>Copyright L&#39;Equipe.fr<span class="p">&lt;/</span><span class="nt">copyright</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="p">&lt;</span><span class="nt">pubDate</span><span class="p">&gt;</span>Thu, 23 Oct 2025 13:23:25 +0200<span class="p">&lt;/</span><span class="nt">pubDate</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="p">&lt;</span><span class="nt">item</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">			<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Le débrief du premier match de la saison de Wembanyama en NBA : « Une façon d&#39;annoncer qu&#39;il va tout écraser »<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">			<span class="p">&lt;</span><span class="nt">link</span><span class="p">&gt;</span>https://www.lequipe.fr/Basket/Actualites/Le-debrief-du-premier-match-de-la-saison-de-wembanyama-en-nba-une-facon-d-annoncer-qu-il-va-tout-ecraser/1603995#at_medium=RSS_feeds<span class="p">&lt;/</span><span class="nt">link</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">			<span class="p">&lt;</span><span class="nt">description</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">				<span class="cp">&lt;![CDATA[ &lt;img src=&#34;https://medias.lequipe.fr/img-photo-png/-/1500000000833469/0-828-552-75/0cb67.png&#34; alt=&#34;Logo L&#39;ÉQUIPE&#34;&gt;Ultra-dominateur face aux Dallas Mavericks pour son retour en NBA après huit mois d&#39;absence, Victor Wembanyama a affiché dès le premier match de la saison des San Antonio Spurs les progrès effectués dans l&#39;intervalle, avec une palette offensive plus complète que jamais. ]]&gt;</span>
</span></span><span class="line"><span class="cl">			<span class="p">&lt;/</span><span class="nt">description</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">			<span class="p">&lt;</span><span class="nt">dc:creator</span><span class="p">&gt;</span>Amaury Perdriau<span class="p">&lt;/</span><span class="nt">dc:creator</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">			<span class="p">&lt;</span><span class="nt">category</span><span class="p">&gt;</span>Basket, NBA, Spurs<span class="p">&lt;/</span><span class="nt">category</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">			<span class="p">&lt;</span><span class="nt">enclosure</span> <span class="na">url</span><span class="o">=</span><span class="s">&#34;https://medias.lequipe.fr/img-photo-png/-/1500000000833469/0-828-552-75/0cb67.png&#34;</span> <span class="na">length</span><span class="o">=</span><span class="s">&#34;50000&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;image/jpeg&#34;</span><span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">			<span class="p">&lt;</span><span class="nt">guid</span><span class="p">&gt;</span>https://www.lequipe.fr/Basket/Actualites/Le-debrief-du-premier-match-de-la-saison-de-wembanyama-en-nba-une-facon-d-annoncer-qu-il-va-tout-ecraser/1603995<span class="p">&lt;/</span><span class="nt">guid</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">			<span class="p">&lt;</span><span class="nt">pubDate</span><span class="p">&gt;</span>Thu, 23 Oct 2025 13:21:49 +0200<span class="p">&lt;/</span><span class="nt">pubDate</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="p">&lt;/</span><span class="nt">item</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">		...
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">rss</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>It is sometimes also possible to transform a page that aggregates posts into a RSS feed using rss.app. For example, using the following page from Le Bonbon : <a href="https://www.lebonbon.fr/paris/sorties/">https://www.lebonbon.fr/paris/sorties/</a> we get an URL pointing to a JSON generated page that looks like :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;https://jsonfeed.org/version/1.1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;Précurseur de tendances&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;home_page_url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://www.lebonbon.fr/paris/sorties/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;feed_url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://rss.app/feeds/v1.1/cCA4EDJMK6KOk6pl.json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;favicon&#34;</span><span class="p">:</span> <span class="s2">&#34;https://www.lebonbon.fr/favicon/lebonbon/apple-touch-icon.png&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;language&#34;</span><span class="p">:</span> <span class="s2">&#34;fr&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Découvre les événements à ne pas manquer près de chez toi : concerts, expositions, festivals, spectacles, soirées&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;items&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;884aac3ebda0c73be65a0e8a778b870b&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://www.lebonbon.fr/paris/bons-plans/que-faire-paris-week-end-24-26-octobre-2025/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;Que faire à Paris ce week-end ? (24-26 octobre)&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;content_text&#34;</span><span class="p">:</span> <span class="s2">&#34;De l’art, de la fête, des spectacles et de la food… Les Bonbons, ce week-end sera pluvieux mais généreux – d’autant plus qu’on aura une heure en plus !&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;content_html&#34;</span><span class="p">:</span> <span class="s2">&#34;\u003Cdiv\u003E\u003Cimg src=\&#34;https://uploads.lebonbon.fr/source/2025/october/2083397/jagodabartus-lebonbon_2_1200.jpg\&#34; style=\&#34;width: 100%;\&#34; /\u003E\u003Cdiv\u003EDe l’art, de la fête, des spectacles et de la food… Les Bonbons, ce week-end sera pluvieux mais généreux – d’autant plus qu’on aura une heure en plus !\u003C/div\u003E\u003C/div\u003E&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;image&#34;</span><span class="p">:</span> <span class="s2">&#34;https://uploads.lebonbon.fr/source/2025/october/2083397/jagodabartus-lebonbon_2_1200.jpg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;date_published&#34;</span><span class="p">:</span> <span class="s2">&#34;2025-10-23T17:00:00.000Z&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;authors&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Maria Sumalla&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;attachments&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://uploads.lebonbon.fr/source/2025/october/2083397/jagodabartus-lebonbon_2_1200.jpg&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;f90e21f1db9a67f263db44ea390e28d3&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://www.lebonbon.fr/paris/loisirs/cette-experience-incroyable-fait-vivre-batailles-napoleon-visiter-france-1800-a-paris/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;Cette expérience incroyable fait vivre les batailles de Napoléon et visiter le Paris de l&#39;époque&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;content_text&#34;</span><span class="p">:</span> <span class="s2">&#34;L’empereur fait son grand retour à Paris ! L’expérience immersive Napoléon, l’Épopée Immersive s’installe dans le cadre monumental de la Poste du Louvre, au cœur du 1er arrondissement.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;content_html&#34;</span><span class="p">:</span> <span class="s2">&#34;\u003Cdiv\u003E\u003Cimg src=\&#34;https://uploads.lebonbon.fr/source/2025/october/2083339/realite-virtuelle-napoleon_2_1200.jpg\&#34; style=\&#34;width: 100%;\&#34; /\u003E\u003Cdiv\u003EL’empereur fait son grand retour à Paris ! L’expérience immersive Napoléon, l’Épopée Immersive s’installe dans le cadre monumental de la Poste du Louvre, au cœur du 1er arrondissement.\u003C/div\u003E\u003C/div\u003E&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;image&#34;</span><span class="p">:</span> <span class="s2">&#34;https://uploads.lebonbon.fr/source/2025/october/2083339/realite-virtuelle-napoleon_2_1200.jpg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;date_published&#34;</span><span class="p">:</span> <span class="s2">&#34;2025-10-23T16:00:00.000Z&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;authors&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;La Rédac&#39;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;attachments&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://uploads.lebonbon.fr/source/2025/october/2083339/realite-virtuelle-napoleon_2_1200.jpg&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span></code></pre></div><p>which is very easy to read.</p>
<h3 id="page-metadata">Page Metadata<a hidden class="anchor" aria-hidden="true" href="#page-metadata">#</a></h3>
<p>In case previous methods did not work, game is not over yet. The page contains valuable information. Before digging into what we can do with the content itself, let’s have a look at the meta tags contained in the head section of the HTML :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">property</span><span class="o">=</span><span class="s">&#34;article:publisher&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;https://www.facebook.com/paris.secret.sn/&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">property</span><span class="o">=</span><span class="s">&#34;article:published_time&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;2022-10-13T09:24:19+00:00&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">property</span><span class="o">=</span><span class="s">&#34;article:modified_time&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;2025-10-20T08:02:28+00:00&#34;</span> <span class="p">/&gt;</span>
</span></span></code></pre></div><p>All pages are not equal and some websites might not embed such information, but when they do, it allows us to check easily (before using any LLM) whether the page has been refreshed since last time.</p>
<h3 id="url">URL<a hidden class="anchor" aria-hidden="true" href="#url">#</a></h3>
<p>URLs might contain valuable information that will allow us to guess the nature of the content. For example, we are interested in knowing when to refresh the following page :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="s2">&#34;https://parissecret.com/que-faire-a-paris-ce-week-end/&#34;</span>
</span></span></code></pre></div><p>The URL itself contains the word “week-end”. Of course, nothing prevents the authors from adding articles during the week-end, on Mondays… But knowing that the page is going to be talking about what to do during the week-end, we might infer that the content can be refreshed once a day. It is not a news website that required us to monitor it every hour.</p>
<p>This might require the help of an LLM, slowing a bit the process.</p>
<h3 id="page-content">Page Content<a hidden class="anchor" aria-hidden="true" href="#page-content">#</a></h3>
<p>Finally, the content of the page. Having to understand the page itself is kind of the worst case scenario. We will definitely have to use an LLM (which is relatively slow) and because LLMs struggle with reading raw HTML (for instance the Huggingface home page is 160k tokens once tokenized, which is more than most models context size), we will have to preprocess the HTML into something that is readable.</p>
<p>But before digging into HTML transformation, let’s look at what we can expect from the content of the page. The parissecret page contains the following meta information about the article :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;/author/lauracoll/&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;notranslate&#34;</span><span class="p">&gt;</span> Laura Coll<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> - Rédactrice en chef<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;single__author__bull-divider&#34;</span><span class="p">&gt;</span><span class="ni">&amp;bull;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">time</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;single__author__date&#34;</span> <span class="na">datetime</span><span class="o">=</span><span class="s">&#34;2025-10-20T08:02:28+00:00&#34;</span><span class="p">&gt;</span>octobre 20, 2025<span class="p">&lt;/</span><span class="nt">time</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>The refresh date is indeed present in the page. This is something we can use.</p>
<h2 id="system">System<a hidden class="anchor" aria-hidden="true" href="#system">#</a></h2>
<h3 id="intermediary-representation">Intermediary Representation<a hidden class="anchor" aria-hidden="true" href="#intermediary-representation">#</a></h3>
<p>To transform HTML into something LLMs can ingest, an easy choice is markdown. Markdown is concise and LLMs are trained to see it. The disadvantage is that it flattens the file. The rich structure of the HTML is lost, and in some cases this might create difficulties on its own.</p>
<p>There are several ways of getting Markdown from HTML. It is not too difficult to write our own serialization system, allowing us to remove parts of the HTML that encodes no information such as images, scripts…</p>
<p>A custom override of the LXML parser might look like :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span><span class="p">,</span> <span class="n">html</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">lxml.html</span> <span class="kn">import</span> <span class="n">HtmlElement</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">custom_tags</span> <span class="kn">import</span> <span class="n">Transparent</span><span class="p">,</span> <span class="n">ToRemove</span><span class="p">,</span> <span class="n">tags_to_remove</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ElementClassLookup</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">CustomElementClassLookup</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">tag_to_class_map</span> <span class="o">=</span> <span class="n">load_classes</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_type</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        Either a tag is explicitly handled or it is marked for removal.
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">node_type</span> <span class="o">!=</span> <span class="s1">&#39;element&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">tag_name</span> <span class="ow">in</span> <span class="n">tags_to_remove</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">ToRemove</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_to_class_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag_name</span><span class="p">,</span> <span class="n">Transparent</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Parser</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">HTMLParser</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">set_element_class_lookup</span><span class="p">(</span><span class="n">ElementClassLookup</span><span class="p">())</span>
</span></span></code></pre></div><p>And a tag might look like :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">custom_tags</span> <span class="kn">import</span> <span class="n">Abstract</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Abstract</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">tag</span> <span class="o">=</span> <span class="s2">&#34;a&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">custom_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">filtered_tag</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        &lt;a&gt; has the following attributes:
</span></span></span><span class="line"><span class="cl"><span class="s2">        - class
</span></span></span><span class="line"><span class="cl"><span class="s2">        - href
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_tag</span><span class="p">(</span><span class="n">filtered_tag</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;href&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">inner_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize_content</span><span class="p">(</span><span class="n">with_children</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;[</span><span class="si">{</span><span class="n">inner_content</span><span class="si">}</span><span class="s2">](</span><span class="si">{</span><span class="n">link</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">serialize_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_children</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">filtered_tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_tag</span><span class="p">(</span><span class="n">filtered_tag</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">content</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">with_children</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">content</span> <span class="o">+=</span> <span class="n">child</span><span class="o">.</span><span class="n">serialize_content</span><span class="p">(</span><span class="n">filtered_tag</span><span class="o">=</span><span class="n">filtered_tag</span><span class="p">,</span> <span class="n">with_children</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">content</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tail</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span></code></pre></div><p>The methods serialize_content, get_tail define how we want to serialize the content of the nodes.</p>
<h3 id="llm-tool-calling">LLM Tool Calling<a hidden class="anchor" aria-hidden="true" href="#llm-tool-calling">#</a></h3>
<p>Once the HTML is transformed into Markdown, the data extraction problem can be reframed as a tool calling problem. We can give a concrete usage of a tool call for this specific case.</p>
<p>Considering the schema contained in the **kwargs is formatted as follows :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;annotations&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Extract data from the current page based on the provided schema.&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;inputSchema&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;additionalProperties&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;The date at which the page has been last modified.&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;The time at which the page has been last modified.&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&#34;extract_data&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>This code might be used as a first draft/pseudo logic :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ExtractionProperty</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ExtractionSchema</span><span class="p">(</span><span class="n">RootModel</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ExtractionProperty</span><span class="p">]]):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ExtractionDataTool</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    This tool is very specific. The schema of its arguments is dynamic and needs to
</span></span></span><span class="line"><span class="cl"><span class="s2">    be inferred before calling the to_dict() method.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">markdown_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ToolCallResult</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">schema_model</span> <span class="o">=</span> <span class="n">ExtractionSchema</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">markdown_content</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">schema_model</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;to_extract&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">ToolCallResult</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">result</span><span class="o">=</span><span class="sa">f</span><span class="s2">&#34;The extracted data is: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">.&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">ToolCallResult</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="o">=</span><span class="s2">&#34;No data extracted. Please check the schema and the content of the page.&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">markdown_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">schema</span><span class="p">:</span> <span class="n">ExtractionSchema</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">to_extract</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">formatted_tool_call</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">messages</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">build_messages</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">markdown_content</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">to_extract</span>
</span></span><span class="line"><span class="cl">            <span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">tools</span><span class="o">=</span><span class="p">[{</span>
</span></span><span class="line"><span class="cl">                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;extract_data&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Extract data from the current page based on the provided schema.&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">input_schema</span><span class="o">=</span><span class="n">FunctionParameters</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">properties</span><span class="o">=</span><span class="n">schema</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">additionalProperties</span><span class="o">=</span><span class="kc">False</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}],</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm_provider</span><span class="o">.</span><span class="n">completion</span><span class="p">(</span><span class="n">formatted_tool_call</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">results</span> <span class="o">=</span> <span class="n">extract_results_from_messages</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">results</span>
</span></span></code></pre></div><h3 id="frequency-update-formula">Frequency Update Formula<a hidden class="anchor" aria-hidden="true" href="#frequency-update-formula">#</a></h3>
<p>As a conceptual exercise, I propose the following formula to update the frequency of scraping. Considering that we have stored every timestamp at which we refreshed the URL and whether the URL changed or not at that timestamp :</p>
<p>$$
x = \left{ (t_i, x_i) \right}_{i \lt en}, t_i \in \mathbb{N}, x_i \in \left{ 0, 1 \right}
$$</p>
<p>The $x_i$ value is either 0 if the page did not change when we refreshed it, 1 otherwise. We are looking for a refresh interval $f_n$ .</p>
<p>Let’s define the following additional variables :</p>
<ul>
<li>$f_n$ the current refresh interval</li>
<li>$r_n$ the current change rate (the proportion of times we check the page and it changed, for example $r_n = 0.5$ means that 50% of the times we checked the page the content changed since previous time)</li>
<li>$r_{t}$ the target change rate
<ul>
<li>A target change rate that is too low means that we check the page too often</li>
<li>A target change rate that is too high that maybe the page is refreshed with a frequency lower than our scraping frequency, and we save some resources by scraping this page less often</li>
<li>We can set the initial target change rate at 0.5</li>
</ul>
</li>
<li>$\alpha$ the smoothing factor, weights how much the near history matters more than the old history</li>
<li>$k$ defines how much we change the interval at every update, could start with 0.2</li>
</ul>
<p>An algorithm might work as follows :</p>
<ol>
<li>
<p>We first update the change rate using the smoothing factor :</p>
<p>$r_n = (\alpha x_n) + ((1 - \alpha) r_{n-1})$</p>
</li>
<li>
<p>Then we refresh the interval :</p>
<p>$f_n = f_{n-1} (1 - k  (r_n - r_t))$</p>
</li>
</ol>
<hr>
<p>The closer $r_n$ is to $r_t$, the lower the difference, and thus the lower is the ajustement we make to the frequency. It is obvious to see that :</p>
<p>$$
\lim_{r_n \to r_t} \Delta f_n = 0
$$</p>
<p>Which is the property we want.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="next" href="https://bornlex.github.io/posts/triton1/">
    <span class="title">Next »</span>
    <br>
    <span>GPT Series - Triton 1 (make GPU go brrr)</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Scraping - Refreshing Frequency on x"
            href="https://x.com/intent/tweet/?text=Scraping%20-%20Refreshing%20Frequency&amp;url=https%3a%2f%2fbornlex.github.io%2fposts%2fscraping-1%2f&amp;hashtags=">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Scraping - Refreshing Frequency on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fbornlex.github.io%2fposts%2fscraping-1%2f&amp;title=Scraping%20-%20Refreshing%20Frequency&amp;summary=Scraping%20-%20Refreshing%20Frequency&amp;source=https%3a%2f%2fbornlex.github.io%2fposts%2fscraping-1%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Scraping - Refreshing Frequency on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fbornlex.github.io%2fposts%2fscraping-1%2f&title=Scraping%20-%20Refreshing%20Frequency">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Scraping - Refreshing Frequency on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fbornlex.github.io%2fposts%2fscraping-1%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Scraping - Refreshing Frequency on whatsapp"
            href="https://api.whatsapp.com/send?text=Scraping%20-%20Refreshing%20Frequency%20-%20https%3a%2f%2fbornlex.github.io%2fposts%2fscraping-1%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Scraping - Refreshing Frequency on telegram"
            href="https://telegram.me/share/url?text=Scraping%20-%20Refreshing%20Frequency&amp;url=https%3a%2f%2fbornlex.github.io%2fposts%2fscraping-1%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Scraping - Refreshing Frequency on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Scraping%20-%20Refreshing%20Frequency&u=https%3a%2f%2fbornlex.github.io%2fposts%2fscraping-1%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2025 <a href="https://bornlex.github.io/">Julien&#39;s blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
